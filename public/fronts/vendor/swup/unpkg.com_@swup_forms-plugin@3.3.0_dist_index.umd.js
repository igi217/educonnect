!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e||self).SwupFormsPlugin=t()}(this,function(){function e(){return e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},e.apply(this,arguments)}const t=e=>String(e).split(".").map(e=>String(parseInt(e||"0",10))).concat(["0","0"]).slice(0,3).join(".");class r{constructor(){this.isSwupPlugin=!0,this.swup=void 0,this.version=void 0,this.requires={},this.handlersToUnregister=[]}mount(){}unmount(){this.handlersToUnregister.forEach(e=>e()),this.handlersToUnregister=[]}_beforeMount(){if(!this.name)throw new Error("You must define a name of plugin when creating a class.")}_afterUnmount(){}_checkRequirements(){return"object"!=typeof this.requires||Object.entries(this.requires).forEach(([e,r])=>{if(!function(e,r,s){const o=function(e,t){var r;if("swup"===e)return null!=(r=t.version)?r:"";{var s;const r=t.findPlugin(e);return null!=(s=null==r?void 0:r.version)?s:""}}(e,s);return!!o&&((e,r)=>r.every(r=>{const[,s,o]=r.match(/^([\D]+)?(.*)$/)||[];var i,n;return((e,t)=>{const r={"":e=>0===e,">":e=>e>0,">=":e=>e>=0,"<":e=>e<0,"<=":e=>e<=0};return(r[t]||r[""])(e)})((n=o,i=t(i=e),n=t(n),i.localeCompare(n,void 0,{numeric:!0})),s||">=")}))(o,r)}(e,r=Array.isArray(r)?r:[r],this.swup)){const t=`${e} ${r.join(", ")}`;throw new Error(`Plugin version mismatch: ${this.name} requires ${t}`)}}),!0}on(e,t,r={}){var s;t=!(s=t).name.startsWith("bound ")||s.hasOwnProperty("prototype")?t.bind(this):t;const o=this.swup.hooks.on(e,t,r);return this.handlersToUnregister.push(o),o}once(t,r,s={}){return this.on(t,r,e({},s,{once:!0}))}before(t,r,s={}){return this.on(t,r,e({},s,{before:!0}))}replace(t,r,s={}){return this.on(t,r,e({},s,{replace:!0}))}off(e,t){return this.swup.hooks.off(e,t)}}const s=({hash:e}={})=>location.pathname+location.search+(e?location.hash:"");class o extends URL{constructor(e,t=document.baseURI){super(e.toString(),t)}get url(){return this.pathname+this.search}static fromElement(e){const t=e.getAttribute("href")||e.getAttribute("xlink:href")||"";return new o(t)}static fromUrl(e){return new o(e)}}return class extends r{constructor(e){void 0===e&&(e={}),super(),this.name="SwupFormsPlugin",this.requires={swup:">=4"},this.defaults={formSelector:"form[data-swup-form]",inlineFormSelector:"form[data-swup-inline-form]"},this.options=void 0,this.specialKeys={Meta:!1,Control:!1,Shift:!1},this.formSubmitDelegate=void 0,this.onKeyDown=e=>{this.specialKeys.hasOwnProperty(e.key)&&(this.specialKeys[e.key]=!0)},this.onKeyUp=e=>{this.specialKeys.hasOwnProperty(e.key)&&(this.specialKeys[e.key]=!1)},this.handleInlineForms=e=>{const{el:t}=e.trigger;if(!t?.matches(this.options.inlineFormSelector))return;if(!t.id)return void console.error("[@swup/forms-plugin] inline forms must have an id attribute:",t);const r=`#${t.id}`;e.containers=[r],e.animation.scope="containers",e.animation.selector=r,e.scroll.target=r},this.options={...this.defaults,...e}}mount(){this.swup.hooks.create("form:submit"),this.swup.hooks.create("form:submit:newtab"),this.formSubmitDelegate=this.swup.delegateEvent(this.options.formSelector,"submit",this.beforeFormSubmit.bind(this),{capture:!0}),this.on("visit:start",this.handleInlineForms,{priority:1}),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp)}unmount(){this.formSubmitDelegate?.destroy(),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp)}beforeFormSubmit(e){const t=this.swup,{delegateTarget:r,submitter:o}=e,i=this.getFormAttr("action",r,o)||s(),n=this.isSpecialKeyPressed(),a="_blank"===this.getFormAttr("target",r,o);if(n||a||!t.shouldIgnoreVisit(i,{el:r,event:e})){if(!a)return n?(t.hooks.callSync("form:submit:newtab",{el:r,event:e}),r.dataset.swupOriginalFormTarget=r.getAttribute("target")||"",r.setAttribute("target","_blank"),void r.addEventListener("submit",()=>requestAnimationFrame(()=>this.restorePreviousFormTarget(r)),{once:!0})):void t.hooks.callSync("form:submit",{el:r,event:e},()=>{this.submitForm(e)});t.hooks.callSync("form:submit:newtab",{el:r,event:e})}}restorePreviousFormTarget(e){e.dataset.swupOriginalFormTarget?e.setAttribute("target",e.dataset.swupOriginalFormTarget):e.removeAttribute("target")}submitForm(e){const t=e.delegateTarget,{url:r,hash:s,method:o,data:i,body:n}=this.getFormInfo(t,e);let a=r,u={method:o};switch(o){case"POST":u={method:o,body:n};break;case"GET":a=this.appendQueryParams(a,i);break;default:return void console.warn(`Unsupported form method: ${o}`)}e.preventDefault(),this.swup.cache.delete(a),this.swup.navigate(a+s,u,{el:t,event:e})}getFormInfo(e,t){let{submitter:r}=t;const i=(this.getFormAttr("method",e,r)||"get").toUpperCase(),n=this.getFormAttr("action",e,r)||s(),{url:a,hash:u}=o.fromUrl(n),h=(this.getFormAttr("enctype",e,r)||"application/x-www-form-urlencoded").toLowerCase(),l="multipart/form-data"===h,c=new FormData(e);let m;return m=l?c:new URLSearchParams(c),{url:a,hash:u,method:i,data:c,body:m,encoding:h}}getFormAttr(e,t,r){return void 0===r&&(r=null),r?.getAttribute(`form${e}`)??t.getAttribute(e)}appendQueryParams(e,t){const r=e.split("?")[0],s=new URLSearchParams(t).toString();return s?`${r}?${s}`:r}isSpecialKeyPressed(){return Object.values(this.specialKeys).some(e=>e)}resetSpecialKeys(){for(const e of Object.keys(this.specialKeys))this.specialKeys[e]=!1}}});
//# sourceMappingURL=index.umd.js.map
